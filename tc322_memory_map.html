<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PFlash Memory Map – 2MB / 1.5MB / 1MB</title>
<style>
  :root{
    --bg:#0b1020;            /* dark canvas */
    --card:#11172e;          /* panel bg */
    --ink:#e6ecff;           /* text */
    --muted:#9fb0ff;         /* subtle text */
    --accent:#6aa1ff;        /* accents */
    --ok:#20c997;            /* available */
    --reserved:#f03e3e;      /* reserved */
    --ps0:#845ef7;           /* PS0 color band */
    --ps1:#22b8cf;           /* PS1 color band */
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,Segoe UI,Roboto,Ubuntu,Apple Color Emoji,Segoe UI Emoji}
  .wrap{max-width:1200px;margin:24px auto;padding:16px}
  header{display:flex;flex-wrap:wrap;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px}
  h1{font-size:clamp(20px,3vw,28px);margin:0;font-weight:700}
  .controls{display:flex;gap:12px;flex-wrap:wrap}
  select,button{background:#0e1530;color:var(--ink);border:1px solid #223059;border-radius:10px;padding:10px 12px;font-weight:600}
  .card{background:var(--card);border:1px solid #223059;border-radius:16px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.25)}

  .legend{display:flex;gap:14px;flex-wrap:wrap;margin:8px 0 0}
  .legend .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#0e1530;border:1px solid #223059}
  .dot{inline-size:14px;block-size:14px;border-radius:50%}
  .dot.ok{background:var(--ok)}
  .dot.res{background:var(--reserved)}
  .dot.ps0{background:var(--ps0)}
  .dot.ps1{background:var(--ps1)}

  .grid{display:grid;grid-template-columns: 1fr minmax(220px, 260px); gap:16px; align-items:start}

  /* Tall visual map */
  .map{position:relative; height:900px; border-radius:14px; overflow:hidden; border:1px solid #223059; background:linear-gradient(180deg, rgba(132,94,247,.12), rgba(34,184,207,.12));}
  .band{position:absolute; inset-inline:0;}
  .band.ps0{inset-block-start:0; inset-block-end:50%; background:linear-gradient(180deg, rgba(132,94,247,.18), transparent)}
  .band.ps1{inset-block-start:50%; inset-block-end:0; background:linear-gradient(180deg, transparent, rgba(34,184,207,.18))}

  .sector{position:absolute; inset-inline:0; border-top:1px dashed rgba(230,236,255,.18);}
  .sector .row{display:flex; align-items:center; justify-content:space-between; padding:0 10px;}
  .sector .labels{display:flex; gap:12px; align-items:center}
  .tag{font:600 12px/1 system-ui; color:var(--muted); background:#0e1530; border:1px solid #223059; border-radius:6px; padding:4px 6px}
  .pill{font:700 11px/1 system-ui; padding:5px 8px; border-radius:999px;}
  .pill.ok{color:#06281e; background:var(--ok)}
  .pill.res{color:#2b0b0b; background:var(--reserved)}

  .sidebar .title{font-weight:700;margin-bottom:8px}
  .table{border:1px solid #223059; border-radius:12px; overflow:hidden}
  table{width:100%; border-collapse:collapse;}
  th,td{padding:10px 12px; border-bottom:1px solid #223059}
  th{background:#0e1530; color:var(--muted); text-align:left; font-size:13px}
  td.addr{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  tr.res td{opacity:.55}

  footer{margin-top:14px;color:var(--muted);font-size:13px}
  a{color:var(--accent)}
  .note{font-size:13px;color:var(--muted)}

  @media (max-width: 900px){
    .grid{grid-template-columns:1fr}
    .map{height:700px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>PFlash Memory Map (Logical Sectors in 16KB steps)</h1>
      <div class="controls">
        <label class="note" for="variant">Bank size:</label>
        <select id="variant" aria-label="Choose PFlash bank size">
          <option value="2">2 MB (S0 – S127)</option>
          <option value="1.5">1.5 MB (S0 – S95, S96–S127 Reserved)</option>
          <option value="1">1 MB (S0 – S63, S64–S127 Reserved)</option>
        </select>
        <button id="btnTop">Scroll to S0</button>
        <button id="btnBottom">Scroll to S127</button>
      </div>
    </header>

    <div class="card legend">
      <div class="chip"><span class="dot ok"></span>Available</div>
      <div class="chip"><span class="dot res"></span>Reserved</div>
      <div class="chip"><span class="dot ps0"></span>PS0 (first 1 MB)</div>
      <div class="chip"><span class="dot ps1"></span>PS1 (second 1 MB)</div>
      <div class="chip">Sector size: 16 KB · Address stride: 0x4000</div>
    </div>

    <div class="grid" id="grid">
      <div class="card map" id="map" aria-label="Visual sector map">
        <div class="band ps0" aria-hidden="true"></div>
        <div class="band ps1" aria-hidden="true"></div>
        <!-- Sectors injected by JS -->
      </div>

      <aside class="sidebar">
        <div class="card">
          <div class="title">Sectors</div>
          <div class="table">
            <table id="table" aria-label="Sector details">
              <thead>
                <tr>
                  <th>Logical</th>
                  <th>PS</th>
                  <th class="addr">Offset</th>
                  <th>State</th>
                </tr>
              </thead>
              <tbody><!-- rows injected --></tbody>
            </table>
          </div>
          <footer>
            Offsets shown from PFlash bank base (e.g., 0xA000_0000). For PS0 (S0–S63) range is 0x000000–0x0FC000; for PS1 (S64–S127) 0x100000–0x1FC000.
          </footer>
        </div>
      </aside>
    </div>

    <footer class="note">
      Tip: Use the selector above to switch between 2MB, 1.5MB, and 1MB variants. Hover the map to see tooltips; reserved sectors are dimmed.
    </footer>
  </div>

<script>
(function(){
  const map = document.getElementById('map');
  const tbody = document.querySelector('#table tbody');
  const variantSel = document.getElementById('variant');
  const btnTop = document.getElementById('btnTop');
  const btnBottom = document.getElementById('btnBottom');

  const SECTOR_SIZE = 16 * 1024; // 16 KB
  const STRIDE_HEX = 0x4000;     // for display convenience

  // Compute y-position for a sector (0..127) within the map.
  function yOf(i){
    // top padding and total height mapping
    const pad = 8; // px
    const usable = map.clientHeight - pad*2;
    return pad + Math.round((i/128) * usable);
  }

  function fmtHex(n, width=6){
    let s = n.toString(16).toUpperCase();
    while(s.length < width) s = '0' + s;
    // format like 0x00 0000h → 00 0000h for easy scan
    return '0x' + s.replace(/([0-9A-F]{2})([0-9A-F]{4})/, '$1_$2');
  }

  function psOf(i){
    return (i < 64) ? 'PS0' : 'PS1';
  }

  function build(variantMB){
    // available sector count by variant
    let availableCount = 128; // 2 MB default
    if(variantMB === 1.5) availableCount = 96;
    if(variantMB === 1)   availableCount = 64;

    map.querySelectorAll('.sector').forEach(el => el.remove());
    tbody.innerHTML = '';

    for(let i=0;i<128;i++){
      const off = i * STRIDE_HEX; // 0x000000, 0x004000, ...
      const reserved = i >= availableCount;

      // Visual lane
      const sec = document.createElement('div');
      sec.className = 'sector';
      // block height segment between this and next line
      const y = yOf(i);
      const yNext = yOf(i+1);
      sec.style.top = y + 'px';
      sec.style.height = (yNext - y) + 'px';
      sec.title = `S${i} • ${psOf(i)} • Offset ${fmtHex(off)} • ${reserved? 'Reserved' : 'Available'} (16 KB)`;

      const row = document.createElement('div');
      row.className = 'row';
      const labels = document.createElement('div');
      labels.className = 'labels';

      const tSec = document.createElement('span');
      tSec.className = 'tag';
      tSec.textContent = 'S'+i;

      const tPs = document.createElement('span');
      tPs.className = 'tag';
      tPs.style.borderColor = i<64 ? 'rgba(132,94,247,.6)' : 'rgba(34,184,207,.6)';
      tPs.textContent = psOf(i);

      const tOff = document.createElement('span');
      tOff.className = 'tag';
      tOff.textContent = fmtHex(off);

      const pill = document.createElement('span');
      pill.className = 'pill ' + (reserved ? 'res' : 'ok');
      pill.textContent = reserved ? 'Reserved' : 'Available';

      labels.append(tSec,tPs,tOff);
      row.append(labels,pill);
      sec.append(row);
      if(reserved){ sec.style.opacity = .45; }
      map.append(sec);

      // Table row
      const tr = document.createElement('tr');
      if(reserved) tr.classList.add('res');
      tr.innerHTML = `<td>S${i}</td><td>${psOf(i)}</td><td class="addr">${fmtHex(off)}</td><td>${reserved? 'Reserved' : 'Available'}</td>`;
      tbody.append(tr);
    }
  }

  // UI wiring
  function readVariant(){
    const v = variantSel.value;
    return v === '2' ? 2 : (v === '1.5' ? 1.5 : 1);
  }

  variantSel.addEventListener('change', ()=> build(readVariant()));
  btnTop.addEventListener('click', ()=> map.scrollTo({top:0,behavior:'smooth'}));
  btnBottom.addEventListener('click', ()=> map.scrollTo({top:map.scrollHeight,behavior:'smooth'}));

  // First paint
  build(readVariant());
})();
</script>
</body>
</html>
