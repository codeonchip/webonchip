<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Civil Engineer Calculator – Structures, Geotech, Hydraulics, Quantities</title>
  <style>
    :root{--bg:#0b1022;--panel:#0f172a;--panel2:#111827;--ink:#e5e7eb;--muted:#94a3b8;--accent:#22d3ee;--ok:#10b981;--warn:#f59e0b;--bad:#ef4444}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(160deg,#0b1024,#0c122b 35%,#0b0f22);color:var(--ink);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial;display:grid;place-items:center;min-height:100vh}
    .app{width:min(1260px,96vw);background:var(--panel);border-radius:16px;box-shadow:0 12px 34px rgba(0,0,0,.55),0 0 0 1px rgba(255,255,255,.05) inset;overflow:hidden;display:grid;grid-template-columns: 320px 1px 1fr;max-height:92vh}
    .divider{background:linear-gradient(180deg,transparent,rgba(255,255,255,.08),transparent)}
    .sidebar{background:linear-gradient(180deg,#0e142b,#111827);padding:14px;display:flex;flex-direction:column;gap:10px}
    .brand{font-weight:800;letter-spacing:.06em;color:var(--accent);text-transform:uppercase;font-size:13px}
    .nav{overflow:auto}
    .nav button{width:100%;text-align:left;padding:10px 12px;border-radius:10px;background:var(--panel2);color:var(--ink);border:0;cursor:pointer;font-weight:700;margin-bottom:8px}
    .nav button[aria-current="page"]{outline:2px solid rgba(34,211,238,.4);background:#0b2d36}
    .nav small{color:var(--muted);display:block;margin-top:2px}
    .content{padding:16px 18px 24px 18px;max-height:92vh;overflow:auto}
    h1{margin:.2em 0 .6em 0;font-size:20px}
    h2{margin:1.2em 0 .4em 0;font-size:16px;color:var(--accent)}
    fieldset{border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;margin:10px 0;background:rgba(255,255,255,.02)}
    legend{padding:0 6px;color:var(--muted)}
    label{display:flex;gap:8px;align-items:center;margin:6px 0}
    input,select,textarea{flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.06);color:var(--ink);font-weight:600}
    .row{display:grid;grid-template-columns: repeat(2, minmax(0,1fr));gap:10px}
    .row3{display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:10px}
    .row4{display:grid;grid-template-columns: repeat(4, minmax(0,1fr));gap:10px}
    .row5{display:grid;grid-template-columns: repeat(5, minmax(0,1fr));gap:10px}
    button.action{background:#0b3d4a;color:var(--ink);border:0;border-radius:10px;padding:10px 12px;font-weight:800;cursor:pointer}
    .muted{color:var(--muted)}
    .chip{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px;font-weight:800}
    .note{font-size:12px;color:var(--muted)}
    .kbd{padding:1px 6px;border-radius:6px;background:rgba(255,255,255,.1);font-family:ui-monospace,Menlo,Consolas,monospace}
    #err{position:fixed;left:12px;bottom:12px;max-width:90vw;background:#3d0b12;color:#ffe3e3;border:1px solid #ef4444;padding:8px 10px;border-radius:8px;display:none;z-index:10}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Civil Engineer Calculator">
    <aside class="sidebar">
      <div class="brand">Civil Engineer Calc</div>
      <div class="nav">
        <button data-view="units" aria-current="page">Basics & Units<br><small>Length, area, volume, pressure, flow</small></button>
        <button data-view="beam">Beam (UDL) – Sizing<br><small>M, δ, required S</small></button>
        <button data-view="retaining">Retaining Wall – Stability<br><small>Rankine Kₐ, FOS</small></button>
        <button data-view="terzaghi">Shallow Foundation (Terzaghi)<br><small>q_ult & q_allow</small></button>
        <button data-view="manning">Open Channel (Manning)<br><small>Rectangular</small></button>
        <button data-view="hazen">Pipe Flow (Hazen–Williams)<br><small>US & SI</small></button>
        <button data-view="rational">Storm Runoff (Rational)<br><small>US & SI</small></button>
        <button data-view="quant">Concrete & Asphalt Quantities<br><small>Slab/footing/cylinder</small></button>
        <button data-view="rebar">Rebar Estimator<br><small>length, count, weight</small></button>
      </div>
      <div class="note" style="margin-top:auto">Tip: press <span class="kbd">/</span> to jump to the first input. These are preliminary calculators—not a substitute for codes or sealed design.</div>
    </aside>
    <div class="divider"></div>

    <main class="content" id="content" tabindex="-1"></main>
  </div>

  <div id="err"></div>

<script>
// ---------- Helpers ----------
if(!Math.log10){ Math.log10 = x => Math.log(x)/Math.LN10; }
const isNum = v => Number.isFinite(v);
const content = document.getElementById('content');
const $q = sel => content.querySelector(sel);
const showErr = (msg)=>{ const e=document.getElementById('err'); e.textContent=msg; e.style.display='block'; setTimeout(()=>e.style.display='none', 6000); };
window.addEventListener('error', ev=>{ showErr('JS error: '+(ev.message||'unknown')); });

function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

// ---------- Views ----------
const views = {
  units(){
    content.innerHTML = `
      <h1>Basics & Unit Converters</h1>
      <fieldset>
        <legend>Length</legend>
        <div class="row4">
          <label>m <input id="u_m" type="number" step="any"></label>
          <label>mm <input id="u_mm" type="number" step="any"></label>
          <label>ft <input id="u_ft" type="number" step="any"></label>
          <label>in <input id="u_in" type="number" step="any"></label>
        </div>
      </fieldset>
      <fieldset>
        <legend>Area</legend>
        <div class="row4">
          <label>m² <input id="u_m2" type="number" step="any"></label>
          <label>ft² <input id="u_ft2" type="number" step="any"></label>
          <label>acre <input id="u_ac" type="number" step="any"></label>
          <label>ha <input id="u_ha" type="number" step="any"></label>
        </div>
      </fieldset>
      <fieldset>
        <legend>Volume</legend>
        <div class="row4">
          <label>m³ <input id="u_m3" type="number" step="any"></label>
          <label>L <input id="u_L" type="number" step="any"></label>
          <label>ft³ <input id="u_ft3" type="number" step="any"></label>
          <label>yd³ <input id="u_yd3" type="number" step="any"></label>
        </div>
      </fieldset>
      <fieldset>
        <legend>Pressure</legend>
        <div class="row4">
          <label>Pa <input id="u_Pa" type="number" step="any"></label>
          <label>kPa <input id="u_kPa" type="number" step="any"></label>
          <label>psi <input id="u_psi" type="number" step="any"></label>
          <label>kN/m² <input id="u_kNm2" type="number" step="any"></label>
        </div>
      </fieldset>
      <fieldset>
        <legend>Flow</legend>
        <div class="row4">
          <label>m³/s <input id="u_cms" type="number" step="any"></label>
          <label>L/s <input id="u_Ls" type="number" step="any"></label>
          <label>cfs <input id="u_cfs" type="number" step="any"></label>
          <label>gpm <input id="u_gpm" type="number" step="any"></label>
        </div>
      </fieldset>
    `;
    const set=(id,val)=>{ const el=$q(id); if(document.activeElement!==el) el.value=(isNum(val)? val:''); };
    // Length
    $q('#u_m').addEventListener('input',()=>{ const v=+$q('#u_m').value; if(!isNum(v)) return; set('#u_mm', v*1000); set('#u_ft', v*3.2808399); set('#u_in', v*39.3700787); });
    $q('#u_mm').addEventListener('input',()=>{ const v=+$q('#u_mm').value; if(!isNum(v)) return; set('#u_m', v/1000); set('#u_ft', v/304.8); set('#u_in', v/25.4); });
    $q('#u_ft').addEventListener('input',()=>{ const v=+$q('#u_ft').value; if(!isNum(v)) return; set('#u_m', v/3.2808399); set('#u_mm', v*304.8); set('#u_in', v*12); });
    $q('#u_in').addEventListener('input',()=>{ const v=+$q('#u_in').value; if(!isNum(v)) return; set('#u_m', v/39.3700787); set('#u_mm', v*25.4); set('#u_ft', v/12); });
    // Area
    $q('#u_m2').addEventListener('input',()=>{ const v=+$q('#u_m2').value; if(!isNum(v)) return; set('#u_ft2', v*10.7639104); set('#u_ac', v*0.000247105); set('#u_ha', v*0.0001); });
    $q('#u_ft2').addEventListener('input',()=>{ const v=+$q('#u_ft2').value; if(!isNum(v)) return; set('#u_m2', v/10.7639104); set('#u_ac', v/43560); set('#u_ha', v/107639.104); });
    $q('#u_ac').addEventListener('input',()=>{ const v=+$q('#u_ac').value; if(!isNum(v)) return; set('#u_m2', v*4046.85642); set('#u_ft2', v*43560); set('#u_ha', v*0.404685642); });
    $q('#u_ha').addEventListener('input',()=>{ const v=+$q('#u_ha').value; if(!isNum(v)) return; set('#u_m2', v*10000); set('#u_ft2', v*107639.104); set('#u_ac', v*2.47105); });
    // Volume
    $q('#u_m3').addEventListener('input',()=>{ const v=+$q('#u_m3').value; if(!isNum(v)) return; set('#u_L', v*1000); set('#u_ft3', v*35.3146667); set('#u_yd3', v*1.30795062); });
    $q('#u_L').addEventListener('input',()=>{ const v=+$q('#u_L').value; if(!isNum(v)) return; set('#u_m3', v/1000); set('#u_ft3', v/28.3168466); set('#u_yd3', v/764.554858); });
    $q('#u_ft3').addEventListener('input',()=>{ const v=+$q('#u_ft3').value; if(!isNum(v)) return; set('#u_m3', v/35.3146667); set('#u_L', v*28.3168466); set('#u_yd3', v/27); });
    $q('#u_yd3').addEventListener('input',()=>{ const v=+$q('#u_yd3').value; if(!isNum(v)) return; set('#u_m3', v/1.30795062); set('#u_L', v*764.554858); set('#u_ft3', v*27); });
    // Pressure
    $q('#u_Pa').addEventListener('input',()=>{ const v=+$q('#u_Pa').value; if(!isNum(v)) return; set('#u_kPa', v/1000); set('#u_psi', v/6894.75729); set('#u_kNm2', v/1000); });
    $q('#u_kPa').addEventListener('input',()=>{ const v=+$q('#u_kPa').value; if(!isNum(v)) return; set('#u_Pa', v*1000); set('#u_psi', v*1000/6894.75729); set('#u_kNm2', v); });
    $q('#u_psi').addEventListener('input',()=>{ const v=+$q('#u_psi').value; if(!isNum(v)) return; set('#u_Pa', v*6894.75729); set('#u_kPa', v*6894.75729/1000); set('#u_kNm2', v*6.89475729); });
    $q('#u_kNm2').addEventListener('input',()=>{ const v=+$q('#u_kNm2').value; if(!isNum(v)) return; set('#u_Pa', v*1000); set('#u_kPa', v); set('#u_psi', v/6.89475729); });
    // Flow
    $q('#u_cms').addEventListener('input',()=>{ const v=+$q('#u_cms').value; if(!isNum(v)) return; set('#u_Ls', v*1000); set('#u_cfs', v*35.3146667); set('#u_gpm', v*15850.3231); });
    $q('#u_Ls').addEventListener('input',()=>{ const v=+$q('#u_Ls').value; if(!isNum(v)) return; set('#u_cms', v/1000); set('#u_cfs', v/28.3168466); set('#u_gpm', v*15.8503231); });
    $q('#u_cfs').addEventListener('input',()=>{ const v=+$q('#u_cfs').value; if(!isNum(v)) return; set('#u_cms', v/35.3146667); set('#u_Ls', v*28.3168466); set('#u_gpm', v*448.831169); });
    $q('#u_gpm').addEventListener('input',()=>{ const v=+$q('#u_gpm').value; if(!isNum(v)) return; set('#u_cms', v/15850.3231); set('#u_Ls', v/15.8503231); set('#u_cfs', v/448.831169); });
  },

  beam(){
    content.innerHTML = `
      <h1>Beam – Simply Supported with Uniform Load</h1>
      <fieldset>
        <legend>Inputs</legend>
        <div class="row4">
          <label>Span L (m) <input id="b_L" type="number" step="any" value="6"></label>
          <label>w (kN/m) <input id="b_w" type="number" step="any" value="10"></label>
          <label>E (GPa) <input id="b_E" type="number" step="any" value="200"></label>
          <label>Allowable σ (MPa) <input id="b_sigA" type="number" step="any" value="165"></label>
        </div>
        <div class="row4">
          <label>Section modulus S (cm³, optional) <input id="b_Scm3" type="number" step="any" placeholder="if known"></label>
          <label>Deflection limit L/Δ <input id="b_LoverD" type="number" step="any" value="360"></label>
          <label>Moment of inertia I (cm⁴, optional) <input id="b_Icm4" type="number" step="any" placeholder="if known"></label>
          <div style="display:flex;align-items:center"><button class="action" id="b_calc">Calculate</button></div>
        </div>
        <div class="note">UDL formulas: M<sub>max</sub>=wL²/8, δ<sub>max</sub>=5wL⁴/(384EI). Units: w in kN/m, L in m, E in GPa → results in SI. If S or I unknown, we’ll compute the required value for stress/deflection.</div>
      </fieldset>
      <h2>Results</h2>
      <div class="row4">
        <div><span class="chip">M<sub>max</sub></span> <span id="b_M">—</span> kN·m</div>
        <div><span class="chip">δ<sub>max</sub></span> <span id="b_def">—</span> mm</div>
        <div><span class="chip">S<sub>req</sub></span> <span id="b_Sreq">—</span> cm³</div>
        <div><span class="chip">I<sub>req</sub></span> <span id="b_Ireq">—</span> cm⁴</div>
      </div>
      <div class="row4">
        <div><span class="chip">σ (given S)</span> <span id="b_sig">—</span> MPa</div>
        <div><span class="chip">Δ limit</span> <span id="b_dok">—</span></div>
        <div><span class="chip">Note</span> <span id="b_note">—</span></div>
        <div></div>
      </div>
    `;
    $q('#b_calc').onclick=()=>{
      const L=+$q('#b_L').value, w=+$q('#b_w').value, E=+$q('#b_E').value*1e9, sigA=+$q('#b_sigA').value*1e6, LOD=+$q('#b_LoverD').value, Scm3=$q('#b_Scm3').value? +$q('#b_Scm3').value: null, Icm4=$q('#b_Icm4').value? +$q('#b_Icm4').value: null;
      if(![L,w,E,sigA,LOD].every(isNum)||L<=0||w<0||E<=0||sigA<=0||LOD<=0) return showErr('Check inputs');
      const Mmax = w*1e3*L*L/8; // N·m
      const def = 5*(w*1e3)*Math.pow(L,4)/(384*E*(Icm4? Icm4*1e-8: 1)); // if I unknown, use I=1 and compute req later
      const delta_mm = (Icm4? def*1000: NaN);
      const Sreq = Mmax/(sigA); // m³
      const Sreq_cm3 = Sreq*1e6; // cm³
      const Ireq = (5*(w*1e3)*Math.pow(L,4)/(384*E*(L/LOD)))*1e8; // cm⁴ required to meet deflection (since δ= L/LOD)
      let sig='—', dok='—';
      if(Scm3){ const S=Scm3/1e6; const sigma = Mmax/S; sig = (sigma/1e6).toFixed(1); }
      if(Icm4){ const limit = L/LOD; dok = (delta_mm<=limit*1000)? 'OK' : 'Exceeds'; }
      $q('#b_M').textContent=(Mmax/1e3).toFixed(2);
      $q('#b_def').textContent= isNum(delta_mm)? delta_mm.toFixed(2): '—';
      $q('#b_Sreq').textContent=Sreq_cm3.toFixed(1);
      $q('#b_Ireq').textContent=Ireq.toFixed(1);
      $q('#b_sig').textContent=sig; $q('#b_dok').textContent=dok; $q('#b_note').textContent='Elastic analysis; check code combos & shear as needed.';
    };
  },

  retaining(){
    content.innerHTML = `
      <h1>Retaining Wall – Gravity Wall Stability (Rankine Active)</h1>
      <fieldset>
        <legend>Geometry & Materials (per meter out of plane)</legend>
        <div class="row4">
          <label>Wall height H (m) <input id="rw_H" type="number" step="any" value="3"></label>
          <label>Base width B (m) <input id="rw_B" type="number" step="any" value="2"></label>
          <label>Toe length b<sub>toe</sub> (m) <input id="rw_bt" type="number" step="any" value="0.6"></label>
          <label>Heel length b<sub>heel</sub> (m) <input id="rw_bh" type="number" step="any" value="1.4"></label>
        </div>
        <div class="row4">
          <label>Stem thickness t<sub>stem</sub> (m) <input id="rw_ts" type="number" step="any" value="0.3"></label>
          <label>Base thickness t<sub>base</sub> (m) <input id="rw_tb" type="number" step="any" value="0.4"></label>
          <label>γ<sub>concrete</sub> (kN/m³) <input id="rw_gcon" type="number" step="any" value="24"></label>
          <label>γ<sub>soil</sub> (kN/m³) <input id="rw_gs" type="number" step="any" value="18"></label>
        </div>
        <div class="row4">
          <label>φ (deg) <input id="rw_phi" type="number" step="any" value="30"></label>
          <label>Surcharge q (kPa) <input id="rw_q" type="number" step="any" value="0"></label>
          <label>Base friction μ <input id="rw_mu" type="number" step="any" value="0.5"></label>
          <div style="display:flex;align-items:center"><button class="action" id="rw_calc">Check</button></div>
        </div>
        <div class="note">Computes K<sub>a</sub>=tan²(45°−φ/2), active earth pressure P<sub>a</sub>=½K<sub>a</sub>γH² + K<sub>a</sub>qH, adds stem & base self‑weight, checks FOS for sliding (μW/P) and overturning (M<sub>res</sub>/M<sub>ot</sub>), and estimates bearing pressures (q<sub>max</sub>, q<sub>min</sub>) assuming rigid foundation and no key/passive resistance.</div>
      </fieldset>
      <h2>Results</h2>
      <div class="row4">
        <div><span class="chip">K<sub>a</sub></span> <span id="rw_Ka">—</span></div>
        <div><span class="chip">P<sub>a</sub></span> <span id="rw_Pa">—</span> kN/m</div>
        <div><span class="chip">ΣW</span> <span id="rw_W">—</span> kN/m</div>
        <div><span class="chip">FOS<sub>slide</sub></span> <span id="rw_FOSs">—</span></div>
      </div>
      <div class="row4">
        <div><span class="chip">FOS<sub>OT</sub></span> <span id="rw_FOSo">—</span></div>
        <div><span class="chip">e</span> <span id="rw_e">—</span> m</div>
        <div><span class="chip">q<sub>max</sub></span> <span id="rw_qmax">—</span> kPa</div>
        <div><span class="chip">q<sub>min</sub></span> <span id="rw_qmin">—</span> kPa</div>
      </div>
      <div class="note">Targets (typical): FOS<sub>slide</sub> ≥ 1.5, FOS<sub>OT</sub> ≥ 2.0, q<sub>min</sub> ≥ 0. Use with judgment & local codes.</div>
    `;
    $q('#rw_calc').onclick=()=>{
      const H=+$q('#rw_H').value, B=+$q('#rw_B').value, bt=+$q('#rw_bt').value, bh=+$q('#rw_bh').value, ts=+$q('#rw_ts').value, tb=+$q('#rw_tb').value;
      const gcon=+$q('#rw_gcon').value, gs=+$q('#rw_gs').value, phi=+$q('#rw_phi').value*Math.PI/180, q=+$q('#rw_q').value, mu=+$q('#rw_mu').value;
      if(![H,B,bt,bh,ts,tb,gcon,gs,phi,mu].every(isNum)||H<=0||B<=0||tb<=0) return showErr('Check geometry/materials');
      const Ka = Math.tan(Math.PI/4 - phi/2)**2;
      const Pa_tri = 0.5*Ka*gs*H*H; // kN/m
      const Pa_surch = Ka*q*H; // kN/m
      const Pa = Pa_tri + Pa_surch;
      // Lever arms from toe (x=0 at toe, base along +x), assume backfill at heel edge
      const y_bar = (Pa_tri*(H/3) + Pa_surch*(H/2)) / (Pa||1e-9); // height above base
      // Self-weight (per meter)
      const W_stem = gcon*ts*H; // kN/m (stem as rectangle at toe? assume at base centerline offset bt)
      const W_base = gcon*B*tb; // base slab
      const W = W_stem + W_base;
      // Moments about toe: overturning from Pa at height y_bar acting at back face ~ lever arm ~ (bt+B?) simplify: take line of action at 0.7B from toe (approx at 2/3B). We'll approximate arm to toe as 0.67B
      const arm_h = 0.67*B; // crude approximation for resultant horizontal arm
      const Mot = Pa * arm_h; // kN·m/m
      const Mres = (W_stem*(bt + ts/2)) + (W_base*(B/2)); // weights lever arms from toe
      const FOS_slide = (mu*W)/Pa;
      const FOS_ot = Mres/Mot;
      // Bearing: resultant location from toe: x_R = (Mres - Mot)/W
      const xR = (Mres - Mot)/W; const e = xR - B/2; // m, +ve toward heel
      const qavg = W/(B*1); // kPa per m length
      let qmax = qavg*(1 + 6*e/B), qmin = qavg*(1 - 6*e/B);
      $q('#rw_Ka').textContent=Ka.toFixed(3);
      $q('#rw_Pa').textContent=Pa.toFixed(2);
      $q('#rw_W').textContent=W.toFixed(2);
      $q('#rw_FOSs').textContent=FOS_slide.toFixed(2);
      $q('#rw_FOSo').textContent=FOS_ot.toFixed(2);
      $q('#rw_e').textContent=e.toFixed(3);
      $q('#rw_qmax').textContent=qmax.toFixed(1);
      $q('#rw_qmin').textContent=qmin.toFixed(1);
    };
  },

  terzaghi(){
    content.innerHTML = `
      <h1>Shallow Foundation – Terzaghi Bearing Capacity</h1>
      <fieldset>
        <legend>Inputs</legend>
        <div class="row4">
          <label>Type <select id="tz_type"><option value="strip">Strip</option><option value="square">Square</option><option value="circle">Circular</option></select></label>
          <label>Width B (m) <input id="tz_B" type="number" step="any" value="2"></label>
          <label>Depth D<sub>f</sub> (m) <input id="tz_Df" type="number" step="any" value="1.2"></label>
          <label>γ (kN/m³) <input id="tz_g" type="number" step="any" value="18"></label>
        </div>
        <div class="row4">
          <label>c (kPa) <input id="tz_c" type="number" step="any" value="0"></label>
          <label>φ (deg) <input id="tz_phi" type="number" step="any" value="30"></label>
          <label>FS target <input id="tz_FS" type="number" step="any" value="3"></label>
          <div style="display:flex;align-items:center"><button class="action" id="tz_calc">Compute</button></div>
        </div>
        <div class="note">q<sub>ult</sub> = cN<sub>c</sub> + γD<sub>f</sub>N<sub>q</sub> + 0.5γBN<sub>γ</sub> (strip). For square/circle, shape factors applied to the third term: 1.3·γBN<sub>γ</sub> (square), 1.2·γBN<sub>γ</sub> (circle). Bearing factors via φ: N<sub>q</sub>=e^{πtanφ}·tan²(45°+φ/2), N<sub>c</sub>=(N<sub>q</sub>−1)cotφ, N<sub>γ</sub>=2(N<sub>q</sub>+1)tanφ. Preliminary only.</div>
      </fieldset>
      <h2>Results</h2>
      <div class="row4">
        <div><span class="chip">N<sub>c</sub></span> <span id="tz_Nc">—</span></div>
        <div><span class="chip">N<sub>q</sub></span> <span id="tz_Nq">—</span></div>
        <div><span class="chip">N<sub>γ</sub></span> <span id="tz_Ng">—</span></div>
        <div><span class="chip">q<sub>ult</sub></span> <span id="tz_qult">—</span> kPa</div>
      </div>
      <div class="row4">
        <div><span class="chip">q<sub>allow</sub></span> <span id="tz_qall">—</span> kPa</div>
        <div><span class="chip">Notes</span> <span id="tz_note">—</span></div>
        <div></div><div></div>
      </div>
    `;
    $q('#tz_calc').onclick=()=>{
      const type=$q('#tz_type').value, B=+$q('#tz_B').value, Df=+$q('#tz_Df').value, g=+$q('#tz_g').value, c=+$q('#tz_c').value, phi=+$q('#tz_phi').value*Math.PI/180, FS=+$q('#tz_FS').value;
      if(![B,Df,g,c,phi,FS].every(isNum)||B<=0||Df<0||g<=0||FS<=0) return showErr('Check inputs');
      const Nq = Math.exp(Math.PI*Math.tan(phi)) * Math.tan(Math.PI/4 + phi/2)**2;
      const Nc = (Nq-1)/Math.tan(phi||1e-9);
      const Ng = 2*(Nq+1)*Math.tan(phi);
      let coeff = 0.5; if(type==='square') coeff=1.3; if(type==='circle') coeff=1.2;
      const qult = c*Nc + g*Df*Nq + coeff*g*B*Ng; // kPa
      const qall = qult/FS;
      $q('#tz_Nc').textContent=Nc.toFixed(2);
      $q('#tz_Nq').textContent=Nq.toFixed(2);
      $q('#tz_Ng').textContent=Ng.toFixed(2);
      $q('#tz_qult').textContent=qult.toFixed(1);
      $q('#tz_qall').textContent=qall.toFixed(1);
      $q('#tz_note').textContent='No water table/depth/shape/inclination factors beyond basic; adjust per code.';
    };
  },

  manning(){
    content.innerHTML = `
      <h1>Open Channel Flow – Manning (Rectangular)</h1>
      <fieldset>
        <legend>Inputs (SI)</legend>
        <div class="row4">
          <label>b (m) <input id="mn_b" type="number" step="any" value="2"></label>
          <label>y (m) <input id="mn_y" type="number" step="any" value="1"></label>
          <label>S (slope) <input id="mn_S" type="number" step="any" value="0.001"></label>
          <label>n (Manning) <input id="mn_n" type="number" step="any" value="0.015"></label>
        </div>
        <div class="row3">
          <div style="display:flex;align-items:center"><button class="action" id="mn_calc">Calculate</button></div>
          <div class="note">Q = (1/n) A R^{2/3} S^{1/2}, A=by, P=b+2y, R=A/P. Results also shown in cfs & gpm.</div>
        </div>
      </fieldset>
      <h2>Results</h2>
      <div class="row4">
        <div><span class="chip">A</span> <span id="mn_A">—</span> m²</div>
        <div><span class="chip">R</span> <span id="mn_R">—</span> m</div>
        <div><span class="chip">Q</span> <span id="mn_Q">—</span> m³/s</div>
        <div><span class="chip">Q</span> <span id="mn_Qus">—</span> cfs</div>
      </div>
    `;
    $q('#mn_calc').onclick=()=>{ const b=+$q('#mn_b').value, y=+$q('#mn_y').value, S=+$q('#mn_S').value, n=+$q('#mn_n').value; if(![b,y,S,n].every(isNum)||b<=0||y<=0||S<=0||n<=0) return showErr('Check inputs'); const A=b*y; const P=b+2*y; const R=A/P; const Q=(1/n)*A*Math.pow(R,2/3)*Math.pow(S,0.5); const cfs = Q*35.3146667; $q('#mn_A').textContent=A.toFixed(3); $q('#mn_R').textContent=R.toFixed(3); $q('#mn_Q').textContent=Q.toFixed(3); $q('#mn_Qus').textContent=cfs.toFixed(1); };
  },

  hazen(){
    content.innerHTML = `
      <h1>Pipe Flow – Hazen–Williams</h1>
      <fieldset>
        <legend>Inputs</legend>
        <div class="row5">
          <label>Units <select id="hz_units"><option value="US">US (ft, gpm)</option><option value="SI">SI (m, L/s)</option></select></label>
          <label>D (diameter) <input id="hz_D" type="number" step="any" value="0.3"></label>
          <label>C (H‑W) <input id="hz_C" type="number" step="any" value="120"></label>
          <label>S (headloss/length) <input id="hz_S" type="number" step="any" value="0.002"></label>
          <div style="display:flex;align-items:center"><button class="action" id="hz_calc">Calculate</button></div>
        </div>
        <div class="note">US: Q(cfs)=1.318 C A R^{0.63} S^{0.54}. Common closed form: Q(gpm)≈0.442 C D(ft)^{2.63} S^{0.54}. SI: Q(m³/s)≈0.849 C D(m)^{2.63} S^{0.54}. For water near 60°F/20°C.</div>
      </fieldset>
      <h2>Results</h2>
      <div class="row4">
        <div><span class="chip">Q</span> <span id="hz_Q">—</span></div>
        <div><span class="chip">Velocity</span> <span id="hz_v">—</span></div>
        <div><span class="chip">Note</span> <span id="hz_note">—</span></div>
        <div></div>
      </div>
    `;
    $q('#hz_calc').onclick=()=>{
      const units=$q('#hz_units').value, D=+$q('#hz_D').value, C=+$q('#hz_C').value, S=+$q('#hz_S').value; if(![D,C,S].every(isNum)||D<=0||C<=0||S<=0) return showErr('Check inputs');
      let Q, v, txt;
      if(units==='US'){
        const Dft = D; // interpret input as ft
        const Qgpm = 0.442*C*Math.pow(Dft,2.63)*Math.pow(S,0.54);
        Q = Qgpm; // gpm
        const Aft2 = Math.PI*Math.pow(Dft,2)/4; const Qcfs = Qgpm/448.831169; v = Qcfs/Aft2; txt = 'US: Q in gpm, v in ft/s';
        $q('#hz_Q').textContent=Qgpm.toFixed(1)+' gpm'; $q('#hz_v').textContent=v.toFixed(2)+' ft/s';
      } else {
        const Dm = D; const Qcms = 0.849*C*Math.pow(Dm,2.63)*Math.pow(S,0.54); Q = Qcms; const Am2 = Math.PI*Math.pow(Dm,2)/4; v = Qcms/Am2; txt='SI: Q in m³/s, v in m/s'; $q('#hz_Q').textContent=Qcms.toExponential(3)+' m³/s'; $q('#hz_v').textContent=v.toFixed(2)+' m/s';
      }
      $q('#hz_note').textContent=txt;
    };
  },

  rational(){
    content.innerHTML = `
      <h1>Storm Runoff – Rational Method</h1>
      <fieldset>
        <legend>US Customary</legend>
        <div class="row4">
          <label>C (0–1) <input id="rm_Cus" type="number" step="any" value="0.7"></label>
          <label>i (in/hr) <input id="rm_ius" type="number" step="any" value="2"></label>
          <label>A (acres) <input id="rm_Aus" type="number" step="any" value="10"></label>
          <div style="display:flex;align-items:center"><button class="action" id="rm_calc_us">Compute US</button></div>
        </div>
      </fieldset>
      <fieldset>
        <legend>SI</legend>
        <div class="row4">
          <label>C (0–1) <input id="rm_Csi" type="number" step="any" value="0.7"></label>
          <label>i (mm/hr) <input id="rm_isi" type="number" step="any" value="50"></label>
          <label>A (km²) <input id="rm_Asi" type="number" step="any" value="0.02"></label>
          <div style="display:flex;align-items:center"><button class="action" id="rm_calc_si">Compute SI</button></div>
        </div>
        <div class="note">US: Q(cfs)=C·i(in/hr)·A(acres). SI: Q(m³/s)=0.278·C·i(mm/hr)·A(km²). Ensure the rainfall intensity matches time of concentration.</div>
      </fieldset>
      <h2>Results</h2>
      <div class="row4">
        <div><span class="chip">Q (US)</span> <span id="rm_Qus">—</span> cfs</div>
        <div><span class="chip">Q (SI)</span> <span id="rm_Qsi">—</span> m³/s</div>
        <div><span class="chip">Note</span> <span id="rm_note">—</span></div>
        <div></div>
      </div>
    `;
    $q('#rm_calc_us').onclick=()=>{ const C=+$q('#rm_Cus').value, i=+$q('#rm_ius').value, A=+$q('#rm_Aus').value; if(![C,i,A].every(isNum)||C<=0||i<=0||A<=0) return showErr('US inputs'); const Q=C*i*A; $q('#rm_Qus').textContent=Q.toFixed(1); $q('#rm_note').textContent='US result filled'; };
    $q('#rm_calc_si').onclick=()=>{ const C=+$q('#rm_Csi').value, i=+$q('#rm_isi').value, A=+$q('#rm_Asi').value; if(![C,i,A].every(isNum)||C<=0||i<=0||A<=0) return showErr('SI inputs'); const Q=0.278*C*i*A; $q('#rm_Qsi').textContent=Q.toFixed(3); $q('#rm_note').textContent='SI result filled'; };
  },

  quant(){
    content.innerHTML = `
      <h1>Concrete & Asphalt Quantities</h1>
      <fieldset>
        <legend>Slab (rectangular)</legend>
        <div class="row4">
          <label>L (m) <input id="q_sL" type="number" step="any" value="10"></label>
          <label>W (m) <input id="q_sW" type="number" step="any" value="5"></label>
          <label>t (m) <input id="q_st" type="number" step="any" value="0.15"></label>
          <label>Material <select id="q_smat"><option value="conc">Concrete</option><option value="asph">Asphalt</option></select></label>
        </div>
        <div class="row3">
          <div style="display:flex;align-items:center"><button class="action" id="q_scalc">Calc</button></div>
          <div class="note">Mass uses density: concrete 2400 kg/m³, asphalt 2320 kg/m³ (≈145 pcf). Also shown in yd³ & tons (US short tons).</div>
        </div>
      </fieldset>
      <fieldset>
        <legend>Footing (rectangular)</legend>
        <div class="row4">
          <label>L (m) <input id="q_fL" type="number" step="any" value="2"></label>
          <label>W (m) <input id="q_fW" type="number" step="any" value="2"></label>
          <label>t (m) <input id="q_ft" type="number" step="any" value="0.5"></label>
          <div style="display:flex;align-items:center"><button class="action" id="q_fcalc">Calc</button></div>
        </div>
      </fieldset>
      <fieldset>
        <legend>Cylinder (pier/column)</legend>
        <div class="row4">
          <label>Diameter D (m) <input id="q_cD" type="number" step="any" value="0.6"></label>
          <label>Height h (m) <input id="q_ch" type="number" step="any" value="3"></label>
          <div></div>
          <div style="display:flex;align-items:center"><button class="action" id="q_ccalc">Calc</button></div>
        </div>
      </fieldset>
      <h2>Results</h2>
      <div class="row4">
        <div><span class="chip">Volume</span> <span id="q_vol">—</span></div>
        <div><span class="chip">Volume (yd³)</span> <span id="q_vyd">—</span></div>
        <div><span class="chip">Mass</span> <span id="q_mass">—</span></div>
        <div><span class="chip">Tonnage</span> <span id="q_ton">—</span></div>
      </div>
    `;
    function out(Vm3, mat){ const vyd = Vm3*1.30795062; const dens = (mat==='asph'? 2320: 2400); const mass = Vm3*dens; const tons = mass/907.18474; $q('#q_vol').textContent=Vm3.toFixed(3)+' m³'; $q('#q_vyd').textContent=vyd.toFixed(2)+' yd³'; $q('#q_mass').textContent=mass.toFixed(0)+' kg'; $q('#q_ton').textContent=tons.toFixed(2)+' tons'; }
    $q('#q_scalc').onclick=()=>{ const L=+$q('#q_sL').value, W=+$q('#q_sW').value, t=+$q('#q_st').value, mat=$q('#q_smat').value; if(![L,W,t].every(isNum)||L<=0||W<=0||t<=0) return showErr('Slab inputs'); out(L*W*t, mat); };
    $q('#q_fcalc').onclick=()=>{ const L=+$q('#q_fL').value, W=+$q('#q_fW').value, t=+$q('#q_ft').value; if(![L,W,t].every(isNum)) return showErr('Footing inputs'); out(L*W*t, 'conc'); };
    $q('#q_ccalc').onclick=()=>{ const D=+$q('#q_cD').value, h=+$q('#q_ch').value; if(![D,h].every(isNum)) return showErr('Cylinder inputs'); out(Math.PI*(D*D/4)*h, 'conc'); };
  },

  rebar(){
    content.innerHTML = `
      <h1>Rebar Estimator</h1>
      <fieldset>
        <legend>Bar Size & Layout</legend>
        <div class="row4">
          <label>Size <select id="rb_size">
            <option value="#3">#3 (9.5 mm)</option>
            <option value="#4" selected>#4 (12.7 mm)</option>
            <option value="#5">#5 (15.9 mm)</option>
            <option value="#6">#6 (19.1 mm)</option>
            <option value="#7">#7 (22.2 mm)</option>
            <option value="#8">#8 (25.4 mm)</option>
            <option value="#9">#9 (28.7 mm)</option>
            <option value="#10">#10 (32.3 mm)</option>
            <option value="#11">#11 (35.8 mm)</option>
          </select></label>
          <label>Bar length (m) <input id="rb_len" type="number" step="any" value="6"></label>
          <label>Spacing (m) <input id="rb_sp" type="number" step="any" value="0.2"></label>
          <label>Panel width (m) <input id="rb_pw" type="number" step="any" value="5"></label>
        </div>
        <div class="row3">
          <div style="display:flex;align-items:center"><button class="action" id="rb_calc">Estimate</button></div>
          <div class="note">Weights per m (approx): #3 0.376, #4 0.668, #5 1.043, #6 1.502, #7 2.044, #8 2.670, #9 3.400, #10 4.303, #11 5.313 kg/m.</div>
        </div>
      </fieldset>
      <h2>Results</h2>
      <div class="row4">
        <div><span class="chip">Bars needed</span> <span id="rb_n">—</span></div>
        <div><span class="chip">Total length</span> <span id="rb_Ltot">—</span></div>
        <div><span class="chip">Total weight</span> <span id="rb_W">—</span></div>
        <div><span class="chip">Note</span> <span id="rb_note">—</span></div>
      </div>
    `;
    const wpm = {"#3":0.376,"#4":0.668,"#5":1.043,"#6":1.502,"#7":2.044,"#8":2.670,"#9":3.400,"#10":4.303,"#11":5.313};
    $q('#rb_calc').onclick=()=>{ const sz=$q('#rb_size').value, L=+$q('#rb_len').value, sp=+$q('#rb_sp').value, pw=+$q('#rb_pw').value; if(![L,sp,pw].every(isNum)||L<=0||sp<=0||pw<=0) return showErr('Inputs'); const n=Math.ceil(pw/sp)+1; const Ltot=n*L; const W=Ltot*wpm[sz]; $q('#rb_n').textContent=n; $q('#rb_Ltot').textContent=Ltot.toFixed(1)+' m'; $q('#rb_W').textContent=W.toFixed(1)+' kg'; $q('#rb_note').textContent='Includes end bars; adjust for laps & edges.'; };
  }
};

function show(view){
  views[view]();
  document.querySelectorAll('.nav button').forEach(b=>{ b.setAttribute('aria-current', b.dataset.view===view? 'page': 'false'); });
  setTimeout(()=>{ const first = content.querySelector('input,select,button'); if(first) first.focus(); }, 0);
}

document.querySelector('.nav').addEventListener('click', (e)=>{ const b = e.target.closest('button[data-view]'); if(!b) return; show(b.dataset.view); });
window.addEventListener('keydown', (e)=>{ if(e.key==='/'){ e.preventDefault(); const i=content.querySelector('input,select,button'); if(i) i.focus(); } });

// Start
show('units');
</script>
</body>
</html>

