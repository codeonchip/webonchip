<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TLF35584 SPI Frame Builder</title>
<style>
  body { font-family: monospace; background: #f5f5f5; color: #222; margin: 40px; }
  h1 { font-size: 1.4em; }
  label { display: block; margin-top: 10px; }
  input { width: 100px; margin-left: 10px; padding: 3px; }
  button { margin-top: 15px; padding: 5px 12px; }
  pre { background: #fff; padding: 10px; border-radius: 6px; margin-top: 20px; border: 1px solid #ccc; }
  .bit { display: inline-block; width: 28px; text-align: center; border: 1px solid #999; margin: 1px; border-radius: 4px; }
</style>
</head>
<body>
  <h1>TLF35584 SPI Frame Builder</h1>
  <p>Build a 16-bit SPI frame (CMD + Address + Data + Parity).<br>
     - CMD: 0 = Read (default), 1 = Write<br>
     - Address: 6-bit hex (0x00–0x3F)<br>
     - Data: 8-bit hex (0x00–0xFF)<br>
     - Parity: even parity (auto-calculated)</p>

  <label>CMD (0=Read,1=Write): <input id="cmd" type="number" min="0" max="1" value="0"></label>
  <label>Address (Hex): <input id="addr" type="text" value="00"></label>
  <label>Data (Hex): <input id="data" type="text" value="00"></label>
  <button onclick="buildFrame()">Build Frame</button>

  <pre id="output"></pre>

  <script>
    function evenParity(value, bits) {
      let count = 0;
      for (let i = 0; i < bits; i++) {
        if (value & (1 << i)) count++;
      }
      return count % 2 === 0 ? 0 : 1; // even parity: parity bit = 1 if odd number of 1s
    }

    function buildFrame() {
      const cmd = parseInt(document.getElementById("cmd").value) & 0x1;
      const addrHex = document.getElementById("addr").value;
      const addr = parseInt(addrHex, 16) & 0x3F;
      const dataHex = document.getElementById("data").value;
      const data = parseInt(dataHex, 16) & 0xFF;

      const frame = (cmd << 14) | (addr << 8) | data;
      const parity = evenParity(frame, 15);
      const fullFrame = (frame << 1) | parity;

      const bin = fullFrame.toString(2).padStart(16, "0");
      const hex = "0x" + fullFrame.toString(16).toUpperCase().padStart(4, "0");

      const labels = ["CMD","A5","A4","A3","A2","A1","A0","D7","D6","D5","D4","D3","D2","D1","D0","P"];

      let info = "";
      info += `CMD: ${cmd} (${cmd === 0 ? "Read" : "Write"})\n`;
      info += `Address: 0x${addrHex.toUpperCase()} (${addr} decimal)\n`;
      info += `Data: 0x${dataHex.toUpperCase()} (${data} decimal)\n`;
      info += `Parity: ${parity} (even parity)\n\n`;
      info += `Binary Frame: ${bin}\nHex Frame: ${hex}\n\n`;
      info += "Bits:\n" + labels.map((l, i) => `${l.padEnd(3)}: ${bin[i]}`).join("  ");

      document.getElementById("output").textContent = info;
    }
  </script>
</body>
</html>
