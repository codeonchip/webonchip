<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Transmission SPN Table</title>
<style>
  :root { --bg:#0f172a; --panel:#111827; --card:#0b1220; --text:#e5e7eb; --muted:#9ca3af; --accent:#60a5fa; }
  html,body{height:100%}
  body{
    margin:0; font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(135deg,var(--bg),#030712); color:var(--text);
    display:flex; flex-direction:column; gap:16px; padding:24px;
  }
  header{display:flex; flex-wrap:wrap; gap:12px; align-items:center}
  h1{font-size:22px; margin:0 12px 0 0}
  .pill{background:rgba(96,165,250,.12); color:var(--accent); border:1px solid rgba(96,165,250,.25);
        padding:6px 10px; border-radius:999px; font-size:12px}
  .tools{display:flex; gap:8px; flex-wrap:wrap; margin-left:auto}
  input[type="search"]{
    background:#0a0f1a; border:1px solid #1f2937; color:var(--text);
    padding:10px 12px; border-radius:10px; min-width:260px;
  }
  button{
    background:#0a0f1a; color:var(--text); border:1px solid #1f2937;
    padding:10px 12px; border-radius:10px; cursor:pointer;
  }
  button:hover{border-color:#374151}
  .table-wrap{background:var(--card); border:1px solid #1f2937; border-radius:14px; overflow:auto}
  table{border-collapse:collapse; width:100%; min-width:900px}
  thead th{
    position:sticky; top:0; background:#0a0f1a; color:#d1d5db;
    padding:12px; text-align:left; border-bottom:1px solid #1f2937; font-weight:600;
    user-select:none; cursor:pointer;
  }
  tbody td{padding:12px; border-bottom:1px solid #111827; vertical-align:top}
  tbody tr:hover{background:#0b1322}
  .num{font-variant-numeric:tabular-nums; color:#dbeafe}
  .muted{color:var(--muted); font-size:13px}
  footer{color:#94a3b8; font-size:12px}
  .nowrap{white-space:nowrap}
  .desc{white-space:pre-wrap}
  .badge{display:inline-block;padding:.15rem .45rem;border:1px solid #1f2937;border-radius:7px;background:#0a0f1a;font-size:12px}
</style>
</head>
<body>
<header>
  <h1>Transmission SPN Data Mapping</h1>
  <span class="pill">J1939 • Gears & Ranges</span>
  <div class="tools">
    <input id="q" type="search" placeholder="Filter (e.g., SPN 523, Range, 2 bytes, park)…" />
    <button id="clearBtn" title="Clear filter">Clear</button>
    <button id="csvBtn" title="Download as CSV">Export CSV</button>
    <button id="jsonBtn" title="Download as JSON">Export JSON</button>
  </div>
</header>

<div class="table-wrap">
  <table id="spnTable" aria-describedby="help">
    <thead>
      <tr>
        <th data-key="bytes" class="nowrap">Bytes</th>
        <th data-key="position" class="nowrap">Position</th>
        <th data-key="spn" class="nowrap">SPN</th>
        <th data-key="name">Signal Name</th>
        <th data-key="description">Description</th>
        <th data-key="length" class="nowrap">Length</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<p id="help" class="muted">
  Tip: click a header to sort. Filter matches any column. If a range uses one display character,
  the second character is used and the first is a space (ASCII&nbsp;32) or a control char (ASCII&nbsp;0–31).
</p>

<footer>
  Built with plain HTML/CSS/JS (no dependencies). © You.
</footer>

<script>
const DATA = [
  {
    bytes: "1",
    position: "1.1",
    spn: 524,
    name: "Transmission Selected Gear",
    description:
`The gear that the transmission will attempt to achieve during the current shift if a shift is in progress, or the next shift if one is pending (waiting for torque reduction to initiate the shift).

Negative values = reverse, positive = forward, 0 = neutral, 251 (FBh) = park.`,
    length: "1 byte"
  },
  {
    bytes: "2–3",
    position: "2.1",
    spn: 526,
    name: "Transmission Actual Gear Ratio",
    description: "Actual ratio of input shaft speed to output shaft speed.",
    length: "2 bytes"
  },
  {
    bytes: "4",
    position: "4.1",
    spn: 523,
    name: "Transmission Current Gear",
    description:
`The gear currently engaged in the transmission or the last gear engaged while the transmission is in the process of shifting to the new or selected gear. Transitions toward a destination gear are not indicated. Once the selected gear has been engaged, this value reflects that gear.

Negative values = reverse, positive = forward, 0 = neutral, 251 (FBh) = park.`,
    length: "1 byte"
  },
  {
    bytes: "5–6",
    position: "5.1",
    spn: 162,
    name: "Transmission Requested Range",
    description:
`Range selected by the operator. Characters may include P, Rx, Rx-1…R2, R1, R, Nx, Nx-1…N2, N1, N, D, D1, D2…Dx, L, L1, L2…Lx-1, 1, 2, 3, … If only one displayed character is required, the second character shall be used and the first character shall be a space (ASCII 32) or a control character (ASCII 0–31). If the first character is a control character, refer to the manufacturer's document.`,
    length: "2 bytes"
  },
  {
    bytes: "7–8",
    position: "7.1",
    spn: 163,
    name: "Transmission Current Range",
    description:
`Range currently being commanded by the transmission control system. Character set mirrors Requested Range. If only one displayed character is required, the second character shall be used and the first shall be a space (ASCII 32) or a control character (ASCII 0–31). If the first character is a control character, refer to the manufacturer's document.`,
    length: "2 bytes"
  }
];

const tbody = document.querySelector("#spnTable tbody");
const q = document.getElementById("q");
const clearBtn = document.getElementById("clearBtn");
const csvBtn = document.getElementById("csvBtn");
const jsonBtn = document.getElementById("jsonBtn");

let sortKey = "bytes";
let sortAsc = true;

function render(rows) {
  tbody.innerHTML = "";
  for (const r of rows) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="num nowrap"><span class="badge">${r.bytes}</span></td>
      <td class="num nowrap">${r.position}</td>
      <td class="num nowrap">${r.spn}</td>
      <td>${r.name}</td>
      <td class="desc">${r.description}</td>
      <td class="nowrap">${r.length}</td>
    `;
    tbody.appendChild(tr);
  }
}

function sortBy(key) {
  sortAsc = (key === sortKey) ? !sortAsc : true;
  sortKey = key;
  const rows = [...filtered()];
  rows.sort((a,b)=>{
    const av = a[key], bv = b[key];
    const an = typeof av === "number";
    const bn = typeof bv === "number";
    const x = (an && bn) ? (av - bv) :
              String(av).localeCompare(String(bv), undefined, {numeric:true});
    return sortAsc ? x : -x;
  });
  render(rows);
}

function filtered() {
  const term = q.value.trim().toLowerCase();
  if (!term) return DATA;
  return DATA.filter(r =>
    [r.bytes, r.position, r.spn, r.name, r.description, r.length]
    .join(" | ").toLowerCase().includes(term)
  );
}

function download(filename, text) {
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([text], {type: "text/plain"}));
  a.download = filename;
  document.body.appendChild(a);
  a.click(); a.remove();
}

// Event wiring
document.querySelectorAll("thead th").forEach(th=>{
  th.addEventListener("click", ()=> sortBy(th.dataset.key));
});

q.addEventListener("input", ()=> sortBy(sortKey));
clearBtn.addEventListener("click", ()=> { q.value=""; sortBy(sortKey); });

csvBtn.addEventListener("click", ()=>{
  const rows = filtered();
  const header = ["Bytes","Position","SPN","Signal Name","Description","Length"];
  const csv = [
    header.join(","),
    ...rows.map(r=>[r.bytes,r.position,r.spn,r.name,
      '"' + r.description.replace(/"/g,'""') + '"', r.length].join(","))
  ].join("\n");
  download("transmission_spn.csv", csv);
});

jsonBtn.addEventListener("click", ()=>{
  download("transmission_spn.json", JSON.stringify(filtered(), null, 2));
});

// Initial render
sortBy("bytes");
</script>
</body>
</html>
