<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Function Plotter + Time/Freq + I/Q</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background-color: #f0f0f0;
    }
    #plot, #iqPlot {
      width: 100%;
      height: 600px;
    }
    input, button, select, label {
      font-size: 1rem;
      margin: 0.5rem 0;
    }
    .controls {
      display: flex;
      flex-direction: column;
      max-width: 600px;
    }
  </style>
</head>
<body>
  <h1>3D Function Plotter + Time/Frequency + I/Q</h1>

  <div class="controls">
    <label for="presetSelect">Choose a preset:</label>
    <select id="presetSelect" onchange="setPresetFunction()">
      <option value="Math.sin(2 * Math.PI * (x - shiftT)) * Math.cos(2 * Math.PI * freq * y)">Time-Shifted Sin * Cos</option>
      <option value="Math.exp(-Math.pow(x - shiftT, 2)) * Math.sin(2 * Math.PI * freq * y)">Shifted Gaussian Modulated Sine</option>
      <option value="(1 + 0.5 * Math.cos(2 * Math.PI * y / 10)) * Math.cos(2 * Math.PI * (x - shiftT))">Shifted AM Signal</option>
    </select>

    <label for="functionInput">Or enter custom function z = f(x, y):</label>
    <input type="text" id="functionInput" value="Math.sin(2 * Math.PI * (x - shiftT)) * Math.cos(2 * Math.PI * freq * y)" style="width: 100%;">

    <label for="shiftT">Time Shift (shiftT): <span id="shiftTLabel">0</span></label>
    <input type="range" id="shiftT" min="-10" max="10" step="0.1" value="0" oninput="updateLabel('shiftT')">

    <label for="freq">Frequency (freq): <span id="freqLabel">1</span></label>
    <input type="range" id="freq" min="0" max="10" step="0.1" value="1" oninput="updateLabel('freq')">

    <button onclick="drawPlot()">Draw</button>
    <button onclick="drawIQPlot()">Plot I/Q Constellation</button>
  </div>

  <div id="plot"></div>
  <h2>I/Q Constellation Plot</h2>
  <div id="iqPlot"></div>

  <script>
    function setPresetFunction() {
      const select = document.getElementById("presetSelect");
      document.getElementById("functionInput").value = select.value;
    }

    function updateLabel(id) {
      const val = document.getElementById(id).value;
      document.getElementById(id + "Label").textContent = val;
    }

    function drawPlot() {
      const funcStr = document.getElementById("functionInput").value;
      const shiftT = parseFloat(document.getElementById("shiftT").value);
      const freq = parseFloat(document.getElementById("freq").value);
      const xRange = numeric.linspace(-10, 10, 50);
      const yRange = numeric.linspace(-10, 10, 50);

      let zData = [];

      for (let i = 0; i < xRange.length; i++) {
        let zRow = [];
        for (let j = 0; j < yRange.length; j++) {
          const x = xRange[i];
          const y = yRange[j];
          try {
            const z = eval(funcStr);
            zRow.push(z);
          } catch (e) {
            zRow.push(0);
          }
        }
        zData.push(zRow);
      }

      const data = [{
        z: zData,
        x: xRange,
        y: yRange,
        type: 'surface'
      }];

      Plotly.newPlot('plot', data);
    }

    function drawIQPlot() {
      const shiftT = parseFloat(document.getElementById("shiftT").value);
      const freq = parseFloat(document.getElementById("freq").value);
      const t = numeric.linspace(-2 * Math.PI, 2 * Math.PI, 100);
      let I = [], Q = [];

      for (let i = 0; i < t.length; i++) {
        const tt = t[i];
        I.push(Math.cos(freq * (tt - shiftT)));
        Q.push(Math.sin(freq * (tt - shiftT)));
      }

      const trace = {
        x: I,
        y: Q,
        mode: 'lines+markers',
        name: 'I/Q Trace',
        type: 'scatter',
        marker: { size: 4 },
        line: { shape: 'spline' }
      };

      const layout = {
        title: 'I/Q Constellation (Circular Orbit at Frequency)',
        xaxis: { title: 'In-Phase (I)' },
        yaxis: { title: 'Quadrature (Q)' },
        width: 600,
        height: 600
      };

      Plotly.newPlot('iqPlot', [trace], layout);
    }

    drawPlot();
    drawIQPlot();
  </script>
</body>
</html>
