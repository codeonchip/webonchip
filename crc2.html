<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CRC8-H2F and CRC32-SDM Calculator</title>
  <style>
    body { font-family: monospace; max-width: 900px; margin: auto; padding: 1em; background: #f8f8f8; }
    textarea { width: 100%; height: 80px; font-family: monospace; }
    table { border-collapse: collapse; margin-top: 1em; }
    td, th { border: 1px solid #999; padding: 4px 8px; text-align: center; }
    .crc-result { font-size: 1.2em; color: green; margin-top: 1em; }
    .table-scroll { max-height: 250px; overflow-y: auto; margin-top: 1em; border: 1px solid #ccc; }
    .buttons { margin-top: 0.5em; }
    button { font-size: 1em; padding: 6px 12px; margin-right: 10px; }
    .highlight { background: yellow; font-weight: bold; }
    .steps { margin-top: 1em; white-space: pre-wrap; background: #eee; padding: 1em; border: 1px solid #ccc; }
  </style>
</head>
<body>

<h1>CRC8-H2F and CRC32-SDM Calculator</h1>

<label for="input">Enter hex bytes (e.g. <code>01 02 03</code>):</label>
<textarea id="input" placeholder="Enter hex values..."></textarea>

<div class="buttons">
  <button onclick="resetForm()">Reset</button>
</div>

<div class="crc-result" id="crc8Result">CRC8-H2F: 0x--</div>
<div class="crc-result" id="crc32Result">CRC32-SDM: 0x--</div>

<h3>CRC8 Step-by-Step Calculation:</h3>
<div class="steps" id="stepOutput">--</div>

<div class="table-scroll">
  <table>
    <thead><tr><th>Index</th><th>Value (Hex)</th></tr></thead>
    <tbody id="crcTableBody"></tbody>
  </table>
</div>

<script>
  const crc8h2f_table = [...]; // Insert CRC8-H2F table values here
  const sdm_crc32_table = [...]; // Insert CRC32 lookup table values here

  const inputBox = document.getElementById("input");
  const crc8ResultEl = document.getElementById("crc8Result");
  const crc32ResultEl = document.getElementById("crc32Result");
  const stepOutput = document.getElementById("stepOutput");
  const tableBody = document.getElementById("crcTableBody");

  function calculateCRCs() {
    clearHighlights();
    const input = inputBox.value.trim();
    if (!input) {
      crc8ResultEl.textContent = 'CRC8-H2F: 0x--';
      crc32ResultEl.textContent = 'CRC32-SDM: 0x--';
      stepOutput.textContent = '--';
      return;
    }

    const bytes = input.split(/\s+/).map(h => parseInt(h, 16));

    // CRC8-H2F
    let crc = 0xFF;
    let steps = `Init CRC: 0xFF\n`;
    for (let i = 0; i < bytes.length; ++i) {
      const before = crc;
      const index = crc ^ bytes[i];
      crc = crc8h2f_table[index];
      steps += `Byte[${i}] = 0x${bytes[i].toString(16).padStart(2, '0')} => Index: 0x${index.toString(16).padStart(2, '0')} => Table[${index}] = 0x${crc.toString(16).padStart(2, '0')}\n`;
      highlightTable(index);
    }
    crc ^= 0xFF;
    steps += `\nFinal XOR with 0xFF: 0x${crc.toString(16).padStart(2, '0')}`;
    crc8ResultEl.textContent = `CRC8-H2F: 0x${crc.toString(16).padStart(2, '0').toUpperCase()}`;
    stepOutput.textContent = steps;

    // CRC32-SDM
    let crc32 = 0xFFFFFFFF;
    for (let i = 0; i < bytes.length; i++) {
      const pos = ((crc32 >>> 24) ^ bytes[i]) & 0xFF;
      crc32 = ((crc32 << 8) >>> 0) ^ sdm_crc32_table[pos];
    }
    crc32ResultEl.textContent = `CRC32-SDM: 0x${crc32.toString(16).padStart(8, '0').toUpperCase()}`;
  }

  function resetForm() {
    inputBox.value = '';
    crc8ResultEl.textContent = 'CRC8-H2F: 0x--';
    crc32ResultEl.textContent = 'CRC32-SDM: 0x--';
    stepOutput.textContent = '--';
    inputBox.focus();
    clearHighlights();
  }

  function highlightTable(index) {
    const rows = tableBody.querySelectorAll("tr");
    if (rows[index]) rows[index].classList.add("highlight");
  }

  function clearHighlights() {
    tableBody.querySelectorAll("tr").forEach(tr => tr.classList.remove("highlight"));
  }

  function fillTable() {
    for (let i = 0; i < crc8h2f_table.length; ++i) {
      const row = document.createElement("tr");
      const tdIndex = document.createElement("td");
      tdIndex.textContent = i.toString(16).padStart(2, '0').toUpperCase();
      const tdVal = document.createElement("td");
      tdVal.textContent = crc8h2f_table[i].toString(16).padStart(2, '0').toUpperCase();
      row.appendChild(tdIndex);
      row.appendChild(tdVal);
      tableBody.appendChild(row);
    }
  }

  inputBox.addEventListener("input", calculateCRCs);
  fillTable();
</script>

</body>
</html>
